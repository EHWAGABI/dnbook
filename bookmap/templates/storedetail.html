<html>
<head>
    <style>
    .black_overlay{
        display: none;
        position: absolute;
        top: 0%;
        left: 0%;
        width: 100%;
        height: 100%;
        background-color: black;
        z-index:1001;
        -moz-opacity: 0.8;
        opacity:.80;
        filter: alpha(opacity=80);
    }
    .white_content {
        display: none;
        position: absolute;
        top: 33%;
        left: 33%;
        width: 33%;
        height: 33%;
        padding: 16px;
        background-color: white;
        z-index:1002;
        overflow: auto;
    }
    .starR{
        background: url('http://miuu227.godohosting.com/images/icon/ico_review.png') no-repeat right 0;
        background-size: auto 100%;
        width: 30px;
        height: 30px;
        display: inline-block;
        text-indent: -9999px;
        cursor: pointer;
    }
    .starR.on{
        background-position:0 0;
    }
</style>
</head>
<h1>책방 디테일 페이지</h1>
{% extends 'base.html' %}
{% block content %}
<body>
    <br>
    <h1>책방 이름 : {{store.name}}</h1>
    <p>스크랩 <span class="badge badge-secondary">{{count}}</span></p>

    {% if user.is_authenticated %}
        {% if scrap %}
            <a href="{% url 'scrap' store.bookstore_id %}">스크랩취소</a>
        {% else %}
            <a href="{% url 'scrap' store.bookstore_id %}">스크랩</a>
        {% endif %}
    {% endif %}
    <br><br>
    
    <p>주소 : {{store.addr}}</p>
    <p>전화번호 : {{store.phone_number}}</p>
    
    {% if store.site %}
    <p>홈페이지 : <a href={{store.site}}>{{store.site}}</a></p>
    {% else %}
    <a href = "javascript:void(0)" onclick = "document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'">사이트</a></p>
    <div id="light" class="white_content">사이트가 존재하지 않습니다. <br><br>
    <a href = "javascript:void(0)" onclick = "document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">닫기</a></div>
    <div id="fade" class="black_overlay"></div>
    {% endif %}
  
    리뷰 | 별점평균: {{star_avg}}
    {% if user.is_authenticated %}
    <form method="POST" action="{% url 'reviewcreate' store.bookstore_id %}">
        {% csrf_token %}
        <span class="starRev form-group">
            <input name="star" value="1" type='radio'>
            <input name="star" value="2" type='radio'>
            <input name="star" value="3" type='radio'>
            <input name="star" value="4" type='radio'>
            <input name="star" value="5" type='radio'>
        </span>
        <script>
        $('.starRev span').click(function(){
            $(this).parent().children('span').removeClass('on');
            $(this).addClass('on').prevAll('span').addClass('on');
            return false;
          });
        </script>
        {{form}}
        <button type='submit'>등록!</button>
    </form>
    {% endif %}

    {% for review in store.review_set.all %}
        <p><strong>{{review.user}}</strong> | {{ review.content }} | ★{{ review.star }}</p>
        {% if review.user == user %}<a href="{% url 'reviewdelete' review.id %}">삭제</a>{% endif %}
    {% endfor %}
    <br>

    <a href="{% url 'crawling' store.bookstore_id %}">크롤링 리뷰보기 <i>※주의※ 오래걸려요..!</i></a>
    <div class='review_hs'>
        {%for review in rev%}
        <a href={{review.link}}>{{review.title}}</a>
        <br>
        {{review.content}}
        <br><br>
        {%endfor%}
    </div>
</body>
{% endblock %}
